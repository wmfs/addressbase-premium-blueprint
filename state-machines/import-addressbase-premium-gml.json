{
  "Comment": "import AddressBase Premium GML",
  "version": "1.0",
  "StartAt": "ExtractStreets",
  "categories": [
    "gazetteer"
  ],
  "instigators": [
    "user"
  ],
  "States": {
    "ExtractStreets": {
      "Type": "Task",
      "InputPath": "$.streets",
      "Resource": "module:flattenXmlFiles",
      "ResourceConfig": {
        "rootXMLElement": "streetMember",
        "pivotPath": "$..StreetDescriptiveIdentifier",
        "headerMap": [
          ["$.Street.changeType", "changeType", "string"],
          ["$.Street.usrn", "usrn", "number"],
          ["@.streetDescription", "description", "string"],
          ["@.townName", "townName", "string"],
          ["@.administrativeArea", "administrativeArea","string"],
          ["$.Street.streetSurface", "surface", "number"],
          ["$.Street.streetClassification", "classification", "number"]
        ],
        "namespace": "strip"
      },
      "Next": "ExtractProperties"
    },
    "ExtractProperties": {
      "Type": "Task",
      "InputPath": "$.property",
      "Resource": "module:flattenXmlFiles",
      "ResourceConfig": {
        "rootXMLElement": "BasicLandPropertyUnit",
        "pivotPath": "$..LandPropertyIdentifier",
        "headerMap": [
          ["@.lpiKey", "lpi_key", "string"],
          ["$.uprn", "uprn", "number"],
          ["$..udprn", "udprn", "number"],
          ["$.changeType", "changeType", "string"],
          ["$.blpuState", "state", "number"],
          ["$.blpuStateDate", "state_date", "date"],
          ["$..classificationCode", "class", "string"],
          ["$.parentUPRN", "parent_uprn", "number"],
          ["$.todo", "x", "string"],
          ["$.todo", "y", "string"],
          ["$.todo", "longitude", "string"],
          ["$.todo", "latitude", "string"],
          ["$.rpc", "rpc", "number"],
          ["$.localCustodianCode", "local_custodian_code", "number"],
          ["$.country", "country", "string"],
          ["$.startDate", "la_start_date", "date"],
          ["$.lastUpdateDate", "last_update_date", "date"],
          ["$.entryDate", "entry_date", "date"],
          ["$.todo", "rm_organisation_name", "string"],
          ["$.todo", "la_organisation", "string"],
          ["$.todo", "department_name", "string"],
          ["$.todo", "legal_name", "string"],
          ["$..DeliveryPointAddress.subBuildingName", "sub_building_name", "string"],
          ["$..DeliveryPointAddress.buildingName", "building_name", "string"],
          ["$..DeliveryPointAddress.buildingNumber", "building_number", "string"],
          ["@.saoStartNumber", "sao_start_number", "string"],
          ["@.saoStartSuffix", "sao_start_suffix", "string"],
          ["@.saoEndNumber", "sao_end_number", "string"],
          ["@.saoEndSuffix", "sao_end_suffix", "string"],
          ["@.saoText", "sao_text", "string"],
          ["$.todo", "alt_language_sao_text", "string"],
          ["@.paoStartNumber", "pao_start_number", "string"],
          ["@.paoStartSuffix", "pao_start_suffix", "string"],
          ["@.paoEndNumber", "pao_end_number", "string"],
          ["@.paoEndSuffix", "pao_end_suffix", "string"],
          ["@.paoText", "pao_text", "string"],
          ["$.todo", "alt_language_pao_text", "string"],
          ["@.usrn", "usrn", "number"],
          ["@.usrnMatchIndicator", "usrn_match_indicator", "number"],
          ["@.areaName", "area_name", "string"],
          ["@.level", "level", "string"],
          ["@.officialFlag", "official_flag", "string"],
          ["$.applicationCrossReferenceMember[?(@.ApplicationCrossReference.source=='7666MA')]..crossReference", "os_address_toid", "string", "comment - 7666MA = OS MasterMap Address Layer 2 TOID"],
          ["$.applicationCrossReferenceMember[?(@.ApplicationCrossReference.source=='7666MA')]..version", "os_address_toid_version", "number"],
          ["$.applicationCrossReferenceMember[?(@.ApplicationCrossReference.source=='7666MI')]..crossReference", "os_road_link_toid", "string", "comment - 7666MI = OS MasterMap Integrated Transport Network TOID."],
          ["$.applicationCrossReferenceMember[?(@.ApplicationCrossReference.source=='7666MI')]..version", "os_road_link_toid_version", "number"],
          ["$.todo", "os_topo_toid", "string"],
          ["$.todo", "os_topo_toid_version", "string"],
          ["$.todo", "voa_ct_record", "string"],
          ["$.todo", "voa_ndr_record", "string"],
          ["$.todo", "street_description", "string"],
          ["$.todo", "alt_language_street_description", "string"],
          ["$.todo", "dependent_thoroughfare", "string"],
          ["$.todo", "thoroughfare", "string"],
          ["$.todo", "welsh_dependent_thoroughfare", "string"],
          ["$.todo", "welsh_thoroughfare", "string"],
          ["$.todo", "double_dependent_locality", "string"],
          ["$.todo", "dependent_locality", "string"],
          ["$.todo", "locality", "string"],
          ["$.todo", "welsh_dependent_locality", "string"],
          ["$.todo", "welsh_double_dependent_locality", "string"],
          ["$.todo", "town_name", "string"],
          ["$.todo", "administrative_area", "string"],
          ["$.todo", "post_town", "string"],
          ["$.todo", "welsh_post_town", "string"],
          ["$.todo", "postcode", "string"],
          ["$.todo", "postcode_locator", "string"],
          ["$.todo", "postcode_type", "string"],
          ["$.todo", "delivery_point_suffix", "string"],
          ["$.todo", "addressbase_portal", "string"],
          ["$.todo", "po_box_number", "string"],
          ["$.todo", "ward_code", "string"],
          ["$.todo", "parish_code", "string"],
          ["$.todo", "rm_start_date", "string"],
          ["$.todo", "multi_occ_count", "string"],
          ["$.todo", "voa_ndrp_desc_code", "string"],
          ["$.todo", "voa_ndr_scat_code", "string"],
          ["$.todo", "alt_language", "string"]
        ],
        "namespace": "strip"
      },
      "End": true
    }
  }
}